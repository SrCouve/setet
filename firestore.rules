rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Função para verificar se o usuário é admin
    function isAdmin() {
      return request.auth != null && 
             request.auth.token.email == 'kaiohyuuga@gmail.com';
    }

    // Regras para usuários
    match /users/{userId} {
      // Admin pode ler e escrever em qualquer documento de usuário
      allow read, write: if isAdmin();
      
      // Usuários normais podem ler e escrever apenas em seus próprios documentos
      allow read, write: if request.auth != null && request.auth.uid == userId;
      
      // Permitir leitura de códigos de usuários
      allow read: if request.auth != null && 
                 request.resource == null &&
                 resource.data.code != null;
      
      match /partners/{partnerId} {
        // Admin pode ler e escrever em qualquer documento de parceiros
        allow read, write: if isAdmin();
        
        // Usuários normais podem ler e escrever apenas em seus próprios parceiros
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
    }

    // Regras para cartas
    match /cards/{cardId} {
      // Qualquer usuário autenticado pode ler cartas
      allow read: if request.auth != null;
      
      // Apenas admin pode escrever em cartas
      allow write: if isAdmin();
    }
  }
} 